<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pour Elora - 21 Mai 2024</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Nunito:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fcefe9;
            --primary-red: #d6334a;
            --text-gray: #444;
            --shadow: rgba(214, 51, 74, 0.12);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Nunito', sans-serif;
        }

        /* L'écran de démarrage qui disparaîtra à tout jamais */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; transition: opacity 1s ease, visibility 1s;
        }

        .start-btn {
            background: none; border: none; cursor: pointer;
            font-size: 5.5rem; transition: transform 0.3s ease;
            animation: pulse 1.5s infinite;
        }

        .start-btn span {
            display: block; font-size: 1rem; color: var(--primary-red);
            font-weight: 600; margin-top: 20px; letter-spacing: 2px; text-transform: uppercase;
        }

        .container { position: relative; width: 100%; height: 100%; }

        .content {
            position: absolute; top: 8%; left: 6%;
            width: 88%; max-width: 420px; z-index: 10;
            pointer-events: none;
        }

        h1 { 
            font-family: 'Dancing Script', cursive; color: var(--primary-red); 
            font-size: clamp(2.2rem, 6vw, 3rem); margin: 0 0 15px 0;
        }

        .message-body {
            font-size: 1.05rem; color: var(--text-gray);
            line-height: 1.6; min-height: 250px;
        }

        .timer-card {
            margin-top: 25px; padding: 15px 20px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 15px; border: 1px solid rgba(214, 51, 74, 0.15);
            box-shadow: 0 8px 30px var(--shadow);
            opacity: 0; transform: translateY(15px);
            animation: slideIn 1s 4s forwards;
            display: inline-block;
        }

        .timer-label { font-size: 0.8rem; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
        .timer-val { font-weight: 600; color: #222; font-size: 1.1rem; display: block; margin-top: 3px; }

        canvas { position: absolute; top: 0; left: 0; z-index: 1; }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .content { top: 6%; left: 5%; width: 90%; }
        }
    </style>
</head>
<body>

    <audio id="loveSong" loop>
        <source src="As the World Caves In - Sarah Cothran (Slowed) (1).mp3" type="audio/mpeg">
    </audio>

    <div class="overlay" id="overlay">
        <button class="start-btn" onclick="initExperience()">
            ❤️
            <span>Pour mon amour</span>
        </button>
    </div>

    <div class="container">
        <div class="content">
            <h1 id="title">Boo...</h1>
            <div class="message-body" id="typewriter"></div>
            <div class="timer-card">
                <span class="timer-label">Notre histoire dure depuis :</span>
                <span class="timer-val" id="timer">Calcul...</span>
            </div>
        </div>
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const CONFIG = {
            startDate: new Date(2024, 4, 21),
            text: `Il y a ton regard à craquer, celui qui me désarme en une seconde, et tes cheveux châtains que j'aime tant.\n\nMais ce que j'aime par-dessus tout, c'est notre complicité. Ton humour un peu « beauf » qui me fait hurler de rire… ce grain de folie qui n'appartient qu'à nous et qui rend chaque journée plus légère.\n\nNos souvenirs à La Rochelle ne me quittent pas. Ce week-end est devenu notre parenthèse à nous, avec ces petits déjeuners sur le port face au soleil... Mais en vrai, le soleil, c’est toi. Celle qui réchauffe tout et qui illumine mes journées, peu importe la météo.\n\nDerrière les délires, tu es mon soutien sans faille. Mon roc, celle qui est là quoi qu'il arrive, sans jamais douter.\n\nDepuis ce 21 mai 2024, on fait pousser notre propre histoire, une branche après l'autre. Tu es ma femme, ma meilleure amie, ma complice de vie.\n\nJe t'aime. ❤️`,
            colors: ['#ff0000', '#ff4d4d', '#dc143c', '#ff69b4', '#ff1493', '#fb8da0']
        };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let branches = [], treeHearts = [], fallingHearts = [];

        function setupCanvas() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = window.innerWidth + 'px';
            canvas.style.height = window.innerHeight + 'px';
        }

        function initExperience() {
            const overlay = document.getElementById('overlay');
            overlay.style.opacity = '0';
            overlay.style.visibility = 'hidden';
            // On le retire physiquement après la transition pour qu'il ne gène plus
            setTimeout(() => overlay.remove(), 1000);

            document.getElementById('loveSong').play().catch(() => {});
            setupCanvas();
            startTypewriter();
            startTimer();
            createTrunk();
            loop();
        }

        function startTimer() {
            const el = document.getElementById('timer');
            const update = () => {
                const diff = new Date() - CONFIG.startDate;
                const d = Math.floor(diff / 86400000);
                const h = Math.floor((diff / 3600000) % 24);
                const m = Math.floor((diff / 60000) % 60);
                const s = Math.floor((diff / 1000) % 60);
                el.innerText = `${d}j ${h}h ${m}m ${s}s de pur bonheur`;
            };
            setInterval(update, 1000); update();
        }

        function startTypewriter() {
            const el = document.getElementById('typewriter');
            let i = 0;
            function type() {
                if (i < CONFIG.text.length) {
                    const char = CONFIG.text.charAt(i);
                    el.innerHTML += char === '\n' ? '<br>' : char;
                    i++;
                    setTimeout(type, char === '.' || char === '…' ? 500 : 40);
                }
            }
            setTimeout(type, 1500);
        }

        class Branch {
            constructor(x, y, angle, len, width) {
                this.x = x; this.y = y; this.angle = angle;
                this.len = len; this.width = width;
                this.curLen = 0;
                this.speed = 1.3 + Math.random() * 0.7;
                this.done = false;
                this.spawned = false;
            }
            update() {
                if (this.curLen < this.len) this.curLen += this.speed;
                else this.done = true;
            }
            draw() {
                ctx.beginPath();
                ctx.strokeStyle = '#4a2c2a';
                ctx.lineWidth = this.width;
                ctx.lineCap = 'round';
                ctx.moveTo(this.x, this.y);
                const ex = this.x + Math.cos(this.angle) * this.curLen;
                const ey = this.y + Math.sin(this.angle) * this.curLen;
                ctx.lineTo(ex, ey);
                ctx.stroke();
                return { x: ex, y: ey };
            }
        }

        function createTrunk() {
            const x = window.innerWidth > 768 ? window.innerWidth * 0.72 : window.innerWidth * 0.55;
            branches.push(new Branch(x, window.innerHeight, -Math.PI/2, 130, 16));
        }

        function drawHeart(x, y, s, color, rotation = 0) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(-s, -s, -s * 1.5, s / 2, 0, s * 1.2);
            ctx.bezierCurveTo(s * 1.5, s / 2, s, -s, 0, 0);
            ctx.fill();
            ctx.restore();
        }

        function loop() {
            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            
            for (let i = 0; i < branches.length; i++) {
                const b = branches[i];
                b.update();
                const end = b.draw();

                if (b.done && !b.spawned) {
                    b.spawned = true;
                    if (b.width > 1.2) {
                        const n = 2 + Math.floor(Math.random() * 2);
                        for (let j = 0; j < n; j++) {
                            const a = b.angle + (Math.random() - 0.5) * 1.2;
                            branches.push(new Branch(end.x, end.y, a, b.len * 0.75, b.width * 0.65));
                        }
                    } else {
                        for (let k = 0; k < 12; k++) {
                            treeHearts.push({
                                x: end.x + (Math.random() - 0.5) * 75,
                                y: end.y + (Math.random() - 0.5) * 75,
                                s: 0, max: Math.random() * 9 + 5,
                                c: CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)]
                            });
                        }
                    }
                }
            }

            treeHearts.forEach(h => {
                if (h.s < h.max) h.s += 0.25;
                drawHeart(h.x, h.y, h.s, h.c);
            });

            // Détachement des cœurs (Départ des cœurs de l'arbre)
            if (treeHearts.length > 40) {
                if (Math.random() < 0.35) {
                    const source = treeHearts[Math.floor(Math.random() * treeHearts.length)];
                    fallingHearts.push({
                        x: source.x, y: source.y, s: source.s * 0.9, c: source.c,
                        vy: 0.8 + Math.random() * 1.2,
                        vx: 0.6 + Math.random() * 1, // Le vent vers la droite
                        osc: Math.random() * Math.PI,
                        rot: 0
                    });
                }
            }

            for (let i = fallingHearts.length - 1; i >= 0; i--) {
                let fh = fallingHearts[i];
                fh.y += fh.vy;
                fh.x += fh.vx + Math.sin(fh.y * 0.04 + fh.osc) * 0.6;
                fh.rot = Math.sin(fh.y * 0.03) * 0.25;
                drawHeart(fh.x, fh.y, fh.s, fh.c, fh.rot);
                if (fh.y > window.innerHeight + 20 || fh.x > window.innerWidth + 20) fallingHearts.splice(i, 1);
            }

            requestAnimationFrame(loop);
        }
        window.addEventListener('resize', setupCanvas);
    </script>
</body>
</html>